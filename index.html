<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Portal AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Marked for Markdown processing (Code syntax highlighting) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1c2e 0%, #303450 100%);
            color: #e2e8f0;
            overflow: hidden;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .card-hover:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .fade-in {
            animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Scrollbar for Chat */
        .chat-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .chat-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .chat-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        .chat-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Message Bubbles */
        .msg-user {
            background: #3b82f6;
            color: white;
            border-radius: 12px 12px 0 12px;
            align-self: flex-end;
        }
        .msg-bot {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border-radius: 12px 12px 12px 0;
            align-self: flex-start;
        }
        
        /* Markdown Styles inside bot messages */
        .prose p { margin-bottom: 0.5em; }
        .prose ul { list-style-type: disc; padding-left: 1.2em; margin-bottom: 0.5em; }
        .prose code { background: rgba(0,0,0,0.3); padding: 2px 4px; rounded: 4px; font-family: monospace; }
        
        /* Typing cursor effect (optional) */
        .typing-cursor::after {
            content: 'â–‹';
            display: inline-block;
            vertical-align: baseline;
            animation: blink 1s step-end infinite;
            color: #3b82f6;
            margin-left: 2px;
        }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Main Navigation Menu -->
    <div id="main-menu" class="text-center w-full max-w-4xl fade-in">
        <h1 class="text-5xl font-bold text-white mb-4 tracking-tight">Learning Portal</h1>
        <p class="text-gray-400 mb-12 text-lg">Select a course to begin your AI-assisted journey</p>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 px-4">
            <!-- Course 1 -->
            <button onclick="navigateTo('page1')" class="glass-panel card-hover rounded-2xl p-8 transition-all duration-300 group text-left relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i data-lucide="book-open" class="w-24 h-24 text-blue-400"></i>
                </div>
                <div class="flex items-center space-x-4 mb-4">
                    <div class="p-3 bg-blue-500/20 rounded-lg text-blue-400">
                        <i data-lucide="layout-dashboard" class="w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white">Course 1</h3>
                </div>
                <p class="text-gray-400 text-sm">Introduction to fundamentals and core concepts.</p>
            </button>

            <!-- Course 2 -->
            <button onclick="navigateTo('page2')" class="glass-panel card-hover rounded-2xl p-8 transition-all duration-300 group text-left relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i data-lucide="settings" class="w-24 h-24 text-green-400"></i>
                </div>
                <div class="flex items-center space-x-4 mb-4">
                    <div class="p-3 bg-green-500/20 rounded-lg text-green-400">
                        <i data-lucide="sliders" class="w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white">Course 2</h3>
                </div>
                <p class="text-gray-400 text-sm">Advanced configuration and system settings.</p>
            </button>

            <!-- Course 3 -->
            <button onclick="navigateTo('page3')" class="glass-panel card-hover rounded-2xl p-8 transition-all duration-300 group text-left relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i data-lucide="user" class="w-24 h-24 text-purple-400"></i>
                </div>
                <div class="flex items-center space-x-4 mb-4">
                    <div class="p-3 bg-purple-500/20 rounded-lg text-purple-400">
                        <i data-lucide="user-circle" class="w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white">Course 3</h3>
                </div>
                <p class="text-gray-400 text-sm">User profiling and personalization techniques.</p>
            </button>

            <!-- Course 4 -->
            <button onclick="navigateTo('page4')" class="glass-panel card-hover rounded-2xl p-8 transition-all duration-300 group text-left relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i data-lucide="bar-chart" class="w-24 h-24 text-red-400"></i>
                </div>
                <div class="flex items-center space-x-4 mb-4">
                    <div class="p-3 bg-red-500/20 rounded-lg text-red-400">
                        <i data-lucide="trending-up" class="w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white">Course 4</h3>
                </div>
                <p class="text-gray-400 text-sm">Data analytics and reporting methodologies.</p>
            </button>
        </div>
    </div>

    <!-- Central Chat / Course Container -->
    <div id="page-container" class="hidden w-full h-[90vh] max-w-6xl fade-in flex flex-col relative">
        
        <!-- Navbar for Subpage -->
        <div class="glass-panel rounded-t-2xl p-4 flex justify-between items-center border-b-0 z-20 shrink-0">
            <h2 id="page-title" class="text-lg font-semibold text-white pl-2">Course Title</h2>
            <button onclick="showMainMenu()" class="flex items-center text-sm text-gray-400 hover:text-white transition-colors px-3 py-1 rounded-lg hover:bg-white/5">
                <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                Back to Courses
            </button>
        </div>

        <!-- Main Chat Area (Custom Built) -->
        <div class="glass-panel rounded-b-2xl flex-1 relative border-t border-white/5 bg-gray-900/50 flex flex-col overflow-hidden">
            
            <!-- Chat History (Messages go here) -->
            <div id="chat-history" class="flex-1 p-6 overflow-y-auto chat-scroll flex flex-col space-y-4">
                <!-- Welcome Message -->
                <div class="msg-bot max-w-[80%] p-4 shadow-sm">
                    <div class="flex items-center gap-2 mb-2 text-blue-400 text-xs font-bold uppercase tracking-wider">
                        <i data-lucide="bot" class="w-3 h-3"></i> AI Tutor
                    </div>
                    <p class="text-sm">Hello! I am your AI course assistant. How can I help you with this course material today?</p>
                </div>
            </div>

            <!-- Loading Indicator (Hidden by default) -->
            <div id="loading-indicator" class="hidden px-6 py-2">
                <div class="flex items-center gap-2 text-gray-400 text-sm">
                    <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce"></div>
                    <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                    <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    <span>...</span>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 bg-gray-900/40 border-t border-white/5">
                <div class="relative flex items-center">
                    <input 
                        type="text" 
                        id="user-input"
                        placeholder="Ask a question about the course..." 
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-4 pr-12 text-white placeholder-gray-500 focus:outline-none focus:border-blue-500/50 focus:bg-white/10 transition-all"
                        onkeypress="handleEnter(event)"
                    >
                    <button onclick="sendMessage()" class="absolute right-2 p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors shadow-lg">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="text-center mt-2">
                     <p class="text-xs text-gray-500">AI can make mistakes. Please verify important information.</p>
                </div>
            </div>

        </div>
    </div>

    <!-- Scripts -->
    <script>
        // CONFIGURATION
        const FLOW_ID = "90ad0982-52c0-4fc0-9660-92735a850aae";
        const BASE_URL = "https://langflow.sail.codes";
        const API_KEY = "sk-jrgWII-Da4LIPWIa294XI3GQgESPkbad4ieCbxfTU48";
        
        let TWEAKS = {
          "ChatInput-7u1gN": {},
          "ParseData-aM2h4": {},
          "Prompt-k78X0": {},
          "SplitText-K1aA4": {},
          "OpenAIModel-zD2Jg": {},
          "ChatOutput-p23wA": {},
          "AstraDB-P1d5i": {},
          "AstraDB-k4u7B": {},
          "File-2zTRX": {}
        };

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            if (window.lucide) lucide.createIcons();
        });

        function showMainMenu() {
            document.getElementById('page-container').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
        }

        function navigateTo(pageId) {
            document.getElementById('main-menu').classList.add('hidden');
            const container = document.getElementById('page-container');
            container.classList.remove('hidden');

            const titles = {
                'page1': 'Course 1: Fundamentals',
                'page2': 'Course 2: System Settings',
                'page3': 'Course 3: User Profiling',
                'page4': 'Course 4: Analytics'
            };
            document.getElementById('page-title').innerText = titles[pageId] || 'Course View';
            
            // Re-init icons for the new view
            if (window.lucide) lucide.createIcons();
        }

        // --- CUSTOM CHAT LOGIC ---

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        async function sendMessage() {
            const inputField = document.getElementById('user-input');
            const message = inputField.value.trim();
            if (!message) return;

            // 1. Add User Message to UI
            addMessageToChat('user', message);
            inputField.value = '';

            // 2. Show Loading
            document.getElementById('loading-indicator').classList.remove('hidden');

            try {
                // 3. Call Langflow API
                const response = await fetch(`${BASE_URL}/api/v1/run/${FLOW_ID}?stream=false`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': API_KEY 
                    },
                    body: JSON.stringify({
                        input_value: message,
                        input_type: 'chat',
                        output_type: 'chat',
                        tweaks: TWEAKS
                    })
                });

                if (!response.ok) {
                    throw new Error(`Server Error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                console.log("Langflow Response:", data); 
                
                // 4. Robust Response Parsing
                let botText = "";
                
                if (data.outputs?.[0]?.outputs?.[0]?.results?.message?.text) {
                    botText = data.outputs[0].outputs[0].results.message.text;
                }
                else if (data.outputs?.[0]?.outputs?.[0]?.results?.text) {
                     botText = data.outputs[0].outputs[0].results.text;
                }
                else if (data.outputs?.[0]?.outputs?.[0]?.artifacts?.message) {
                    botText = data.outputs[0].outputs[0].artifacts.message;
                }
                else {
                     console.warn("Unexpected JSON structure:", data);
                     botText = "I received a response, but I couldn't find the text message inside it. Please check the console (F12) to see the raw data.";
                }

                // 5. Show Bot Response
                addMessageToChat('bot', botText);

            } catch (error) {
                console.error("API Error:", error);
                addMessageToChat('bot', `Connection Error: ${error.message}. Please check your API Key and Network.`);
            } finally {
                document.getElementById('loading-indicator').classList.add('hidden');
            }
        }

        function addMessageToChat(sender, text) {
            const history = document.getElementById('chat-history');
            const div = document.createElement('div');
            
            if (sender === 'user') {
                div.className = "msg-user max-w-[80%] p-4 shadow-sm text-sm";
                div.innerText = text; 
                history.appendChild(div);
                history.scrollTop = history.scrollHeight;
            } else {
                // Bot Message container
                div.className = "msg-bot max-w-[80%] p-4 shadow-sm prose prose-invert prose-sm";
                div.innerHTML = `
                    <div class="flex items-center gap-2 mb-2 text-blue-400 text-xs font-bold uppercase tracking-wider">
                        <i data-lucide="bot" class="w-3 h-3"></i> AI Tutor
                    </div>
                    <div class="typing-container typing-cursor"></div>
                `;
                
                history.appendChild(div);
                const typingContainer = div.querySelector('.typing-container');
                
                // --- TYPING EFFECT LOGIC ---
                let i = 0;
                const speed = 15; // Speed in ms (lower is faster)
                
                function typeWriter() {
                    if (i < text.length) {
                        // Type a few characters at once to be performant but smooth
                        const chunk = text.slice(0, i + 2); 
                        typingContainer.innerHTML = marked.parse(chunk);
                        i += 2;
                        history.scrollTop = history.scrollHeight;
                        setTimeout(typeWriter, speed);
                    } else {
                        // Done typing
                        typingContainer.innerHTML = marked.parse(text);
                        typingContainer.classList.remove('typing-cursor'); // Remove cursor
                        history.scrollTop = history.scrollHeight;
                    }
                }
                
                // Start typing
                typeWriter();
            }
            
            if (window.lucide) lucide.createIcons();
        }
    </script>

</body>
</html>
